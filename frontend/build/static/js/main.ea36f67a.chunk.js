(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{234:function(e,t){},235:function(e,t){},298:function(e,t,a){e.exports=a(434)},309:function(e,t){},431:function(e,t,a){},434:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(44),i=a.n(o),l=a(214),s=a(30),c=a(10),u=a.n(c),m=a(26),d=a(12),g=a(13),p=a(21),h=a(22),f=a(49),b=a(286),v=a(81),y=a(96),x=(a(304),function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).drawGraph=function(){var t=e.props,a=t.currentWork,n=t.selectWork;if(null!==a&&"id"in a&&null!==a.id){var r=y.e().duration(360).ease(y.a);y.c("#graph").graphviz({zoom:!1}).transition(r).renderDot(a.digraph).on("end",(function(){y.d(".relation-node").attr("tabindex","0").on("click",(function(e){n(e.key)})).on("keypress",(function(e){13===y.b.keyCode&&n(e.key)})),y.d(".current-work-node").on("click",null)}))}},e}return Object(g.a)(a,[{key:"componentDidUpdate",value:function(){this.drawGraph()}},{key:"render",value:function(){return r.a.createElement("div",{id:"graph"})}}]),a}(n.Component)),k=a(23),E=a(73),w=a(134),R=a(68),C=a(14),S=a(131),j=a(130),O=a(17),M=a(275),U=a(190),A=a.n(U),W=A()();W.configure(A.a.rest().fetch(window.fetch)).configure(A.a.authentication({storage:window.localStorage}));var T=function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).patchUser=function(){var e=n.props,t=e.login,a=e.selectWork,r=e.stagedUserPatch,o=e.targetUser,i=e.toggleAccountModal;n.setState({isSubmitting:!0}),W.service("users").patch(o.id,r).then((function(){t(!0),a(),i(),n.setState({isSubmitting:!1})}))},n.deleteUser=function(){var e=n.props,t=e.targetUser,a=e.toggleAccountModal;n.setState({isSubmitting:!0}),W.service("users").remove(t.id).then((function(){a(),n.setState({isSubmitting:!1})}))},n.handleChange=function(e){var t=n.props,a=t.setStagedUserPatch,r=t.stagedUserPatch,o=e.target.value.trim(),i={"account-display-name-input":"displayName","account-email-input":"email"}[e.target.id],l=o||null;a(Object(C.a)(Object(C.a)({},r),{},Object(R.a)({},i,l)))},n.isEmailValid=function(){var e=n.props.stagedUserPatch;return M.validate(e.email)||!e.email},n.isReadyToSubmit=function(){var e=n.props,t=e.currentUser,a=e.stagedUserPatch,r=t.displayName===a.displayName&&t.email===a.email;return a.displayName&&n.isEmailValid()&&!r},n.state={isSubmitting:!1},n}return Object(g.a)(a,[{key:"render",value:function(){var e=this.props,t=e.showAccountModal,a=e.relataConfig,n=e.stagedUserPatch,o=e.targetUser,i=e.toggleAccountModal,l=this.state.isSubmitting,s=a.oauthProviders?a.oauthProviders.filter((function(e){return null!==o["".concat(e.id,"Id")]})).map((function(e){return e.name})).join(" and "):[],c=s.length>0?r.a.createElement("p",null,"This account authenticates via ",s,"."):null,u=!this.isReadyToSubmit();return r.a.createElement(O.a,{show:t,onHide:i,size:"md"},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,"Account")),r.a.createElement(O.a.Body,null,c,r.a.createElement("label",{id:"account-display-name-input-label",htmlFor:"account-display-name-input"},"Display Name"),r.a.createElement(j.a,{className:"mb-3"},r.a.createElement(S.a,{id:"account-display-name-input","aria-describedby":"account-display-name-input-label",defaultValue:n.displayName,placeholder:"Name to display on annotations",maxLength:100,onChange:this.handleChange})),r.a.createElement("label",{id:"account-email-input-label",htmlFor:"account-email-input"},"Email ",r.a.createElement("i",null,"(optional)")),r.a.createElement(j.a,{className:"mb-3"},r.a.createElement(S.a,{id:"account-email-input","aria-describedby":"account-email-input-label",isInvalid:!this.isEmailValid(),defaultValue:n.email,placeholder:"Enter a valid email, e.g., first.last@domain.edu",maxLength:100,onChange:this.handleChange}))),r.a.createElement(O.a.Footer,null,r.a.createElement(k.a,{variant:"outline-secondary",onClick:i},"Cancel"),r.a.createElement(k.a,{disabled:u||l,style:u||l?{cursor:"not-allowed"}:{},variant:"primary",onClick:this.patchUser},l?"Submitting\u2026":"Submit")))}}]),a}(n.Component),N=a(71),_=a(288),F=a(289),L=a(285),B=a(58),z=a(18),P=a(187),I=a(276),H=a(95),G=function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleClick=function(t){var a=e.props,n=a.setStagedRelation,r=a.stagedRelation;n(Object(C.a)(Object(C.a)({},r),{},{type:t}))},e.handleAnnotationBlur=function(t){(0,e.props.setStagedAnnotation)(t.target.value.replace(/\s+/g," ").trim())},e}return Object(g.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.relataConfig,n=t.stagedAnnotation,o=t.stagedRelation.type||"Relation Type",i=(a.types?Object.keys(a.types).filter((function(e){return"*"!==e})).sort():[]).map((function(t,n){var o=a.types[t].color,i={borderLeft:"0.25rem solid ".concat(o)};return r.a.createElement(P.a.Item,{key:n,style:i,onClick:function(){return e.handleClick(t)}},t)}));return r.a.createElement(z.a,{className:"mt-3"},r.a.createElement(z.a.Body,null,r.a.createElement(v.a,null,r.a.createElement(f.a,{sm:3},r.a.createElement(H.a.Label,{htmlFor:"relation-type-dropdown"},"Relation Type"),r.a.createElement(I.a,{id:"relation-type-dropdown",variant:"outline-primary",title:o},i)),r.a.createElement(f.a,{sm:9},r.a.createElement(H.a.Group,{controlId:"annotation-textarea"},r.a.createElement(H.a.Label,null,"Annotation ",r.a.createElement("i",null,"(optional)")),r.a.createElement(H.a.Control,{as:"textarea",defaultValue:n,rows:"1",style:{minHeight:"2.4rem"},maxLength:500,onBlur:this.handleAnnotationBlur}))))))}}]),a}(n.Component),D=a(277),K=a.n(D),q=function(e,t,a){return r.a.createElement("a",{href:e,key:a,rel:"noopener noreferrer",target:"_blank",onClick:function(e){return e.stopPropagation()},style:{wordBreak:"break-all",msWordBreak:"break-all"}},t)},$=function(e){return r.a.createElement(K.a,{componentDecorator:q},e.children)},V=a(186),J=a(192),Y=a(180),Q=a(19),Z=a(31),X=a(183),ee=a(280),te=a(94),ae=function(e,t){return["article-journal","book","chapter","manuscript","paper-conference","report"].includes(e.type)},ne=function(e){return e.type={"journal-article":"article-journal","book-chapter":"chapter","posted-content":"manuscript","proceedings-article":"paper-conference"}[e.type]||e.type,delete e.id,e},re=function(){var e=Object(m.a)(u.a.mark((function e(t){var a,n,r,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new URL("https://api.crossref.org/works")).searchParams.set("rows",20),a.searchParams.set("query.bibliographic",t),e.next=5,fetch(a.href);case 5:return n=e.sent,e.next=8,n.json();case 8:return r=e.sent,o=r.message.items,e.abrupt("return",o);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),oe=a(217),ie=a.n(oe);ie.a.CSL.register.addTemplate("chicago-author-date",'<?xml version="1.0" encoding="utf-8"?>\n<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0" demote-non-dropping-particle="display-and-sort" page-range-format="chicago">\n  <info>\n    <title>Chicago Manual of Style 17th edition (author-date)</title>\n    <id>http://www.zotero.org/styles/chicago-author-date</id>\n    <link href="http://www.zotero.org/styles/chicago-author-date" rel="self"/>\n    <link href="http://www.chicagomanualofstyle.org/tools_citationguide.html" rel="documentation"/>\n    <author>\n      <name>Julian Onions</name>\n      <email>julian.onions@gmail.com</email>\n    </author>\n    <contributor>\n      <name>Sebastian Karcher</name>\n    </contributor>\n    <contributor>\n      <name>Richard Karnesky</name>\n      <email>karnesky+zotero@gmail.com</email>\n      <uri>http://arc.nucapt.northwestern.edu/Richard_Karnesky</uri>\n    </contributor>\n    <contributor>\n      <name>Andrew Dunning</name>\n      <email>andrew.dunning@utoronto.ca</email>\n      <uri>https://orcid.org/0000-0003-0464-5036</uri>\n    </contributor>\n    <contributor>\n      <name>Matthew Roth</name>\n      <email>matthew.g.roth@yale.edu</email>\n      <uri> https://orcid.org/0000-0001-7902-6331</uri>\n    </contributor>\n    <category citation-format="author-date"/>\n    <category field="generic-base"/>\n    <summary>The author-date variant of the Chicago style</summary>\n    <updated>2018-01-24T12:00:00+00:00</updated>\n    <rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights>\n  </info>\n  <locale xml:lang="en">\n    <terms>\n      <term name="editor" form="verb-short">ed.</term>\n      <term name="container-author" form="verb">by</term>\n      <term name="translator" form="verb-short">trans.</term>\n      <term name="editortranslator" form="verb">edited and translated by</term>\n      <term name="translator" form="short">trans.</term>\n    </terms>\n  </locale>\n  <macro name="secondary-contributors">\n    <choose>\n      <if type="chapter entry-dictionary entry-encyclopedia paper-conference" match="none">\n        <group delimiter=". ">\n          <names variable="editor translator" delimiter=". ">\n            <label form="verb" text-case="capitalize-first" suffix=" "/>\n            <name and="text" delimiter=", "/>\n          </names>\n          <names variable="director" delimiter=". ">\n            <label form="verb" text-case="capitalize-first" suffix=" "/>\n            <name and="text" delimiter=", "/>\n          </names>\n        </group>\n      </if>\n    </choose>\n  </macro>\n  <macro name="container-contributors">\n    <choose>\n      <if type="chapter entry-dictionary entry-encyclopedia paper-conference" match="any">\n        <group prefix=", " delimiter=", ">\n          <names variable="container-author" delimiter=", ">\n            <label form="verb" suffix=" "/>\n            <name and="text" delimiter=", "/>\n          </names>\n          <names variable="editor translator" delimiter=", ">\n            <label form="verb" suffix=" "/>\n            <name and="text" delimiter=", "/>\n          </names>\n        </group>\n      </if>\n    </choose>\n  </macro>\n  <macro name="editor">\n    <names variable="editor">\n      <name name-as-sort-order="first" and="text" sort-separator=", " delimiter=", " delimiter-precedes-last="always"/>\n      <label form="short" prefix=", "/>\n    </names>\n  </macro>\n  <macro name="translator">\n    <names variable="translator">\n      <name name-as-sort-order="first" and="text" sort-separator=", " delimiter=", " delimiter-precedes-last="always"/>\n      <label form="short" prefix=", "/>\n    </names>\n  </macro>\n  <macro name="recipient">\n    <choose>\n      <if type="personal_communication">\n        <choose>\n          <if variable="genre">\n            <text variable="genre" text-case="capitalize-first"/>\n          </if>\n          <else>\n            <text term="letter" text-case="capitalize-first"/>\n          </else>\n        </choose>\n      </if>\n    </choose>\n    <names variable="recipient" delimiter=", ">\n      <label form="verb" prefix=" " text-case="lowercase" suffix=" "/>\n      <name and="text" delimiter=", "/>\n    </names>\n  </macro>\n  <macro name="substitute-title">\n    <choose>\n      <if type="article-magazine article-newspaper review review-book" match="any">\n        <text macro="container-title"/>\n      </if>\n    </choose>\n  </macro>\n  <macro name="contributors">\n    <group delimiter=". ">\n      <names variable="author">\n        <name and="text" name-as-sort-order="first" sort-separator=", " delimiter=", " delimiter-precedes-last="always"/>\n        <label form="short" prefix=", "/>\n        <substitute>\n          <names variable="editor"/>\n          <names variable="translator"/>\n          <names variable="director"/>\n          <text macro="substitute-title"/>\n          <text macro="title"/>\n        </substitute>\n      </names>\n      <text macro="recipient"/>\n    </group>\n  </macro>\n  <macro name="contributors-short">\n    <names variable="author">\n      <name form="short" and="text" delimiter=", " initialize-with=". "/>\n      <substitute>\n        <names variable="editor"/>\n        <names variable="translator"/>\n        <names variable="director"/>\n        <text macro="substitute-title"/>\n        <text macro="title"/>\n      </substitute>\n    </names>\n  </macro>\n  <macro name="interviewer">\n    <names variable="interviewer" delimiter=", ">\n      <label form="verb" prefix=" " text-case="capitalize-first" suffix=" "/>\n      <name and="text" delimiter=", "/>\n    </names>\n  </macro>\n  <macro name="archive">\n    <group delimiter=". ">\n      <text variable="archive_location" text-case="capitalize-first"/>\n      <text variable="archive"/>\n      <text variable="archive-place"/>\n    </group>\n  </macro>\n  <macro name="access">\n    <group delimiter=". ">\n      <choose>\n        <if type="graphic report" match="any">\n          <text macro="archive"/>\n        </if>\n        <else-if type="article-journal bill book chapter legal_case legislation motion_picture paper-conference" match="none">\n          <text macro="archive"/>\n        </else-if>\n      </choose>\n      <choose>\n        <if type="webpage post-weblog" match="any">\n          <date variable="issued" form="text"/>\n        </if>\n      </choose>\n      <choose>\n        <if variable="issued" match="none">\n          <group delimiter=" ">\n            <text term="accessed" text-case="capitalize-first"/>\n            <date variable="accessed" form="text"/>\n          </group>\n        </if>\n      </choose>\n      <choose>\n        <if type="legal_case" match="none">\n          <choose>\n            <if variable="DOI">\n              <text variable="DOI" prefix="https://doi.org/"/>\n            </if>\n            <else>\n              <text variable="URL"/>\n            </else>\n          </choose>\n        </if>\n      </choose>\n    </group>\n  </macro>\n  <macro name="title">\n    <choose>\n      <if variable="title" match="none">\n        <choose>\n          <if type="personal_communication" match="none">\n            <text variable="genre" text-case="capitalize-first"/>\n          </if>\n        </choose>\n      </if>\n      <else-if type="bill book graphic legislation motion_picture song" match="any">\n        <text variable="title" text-case="title" font-style="italic"/>\n        <group prefix=" (" suffix=")" delimiter=" ">\n          <text term="version"/>\n          <text variable="version"/>\n        </group>\n      </else-if>\n      <else-if variable="reviewed-author">\n        <choose>\n          <if variable="reviewed-title">\n            <group delimiter=". ">\n              <text variable="title" text-case="title" quotes="true"/>\n              <group delimiter=", ">\n                <text variable="reviewed-title" text-case="title" font-style="italic" prefix="Review of "/>\n                <names variable="reviewed-author">\n                  <label form="verb-short" text-case="lowercase" suffix=" "/>\n                  <name and="text" delimiter=", "/>\n                </names>\n              </group>\n            </group>\n          </if>\n          <else>\n            <group delimiter=", ">\n              <text variable="title" text-case="title" font-style="italic" prefix="Review of "/>\n              <names variable="reviewed-author">\n                <label form="verb-short" text-case="lowercase" suffix=" "/>\n                <name and="text" delimiter=", "/>\n              </names>\n            </group>\n          </else>\n        </choose>\n      </else-if>\n      <else-if type="legal_case interview patent" match="any">\n        <text variable="title"/>\n      </else-if>\n      <else>\n        <text variable="title" text-case="title" quotes="true"/>\n      </else>\n    </choose>\n  </macro>\n  <macro name="edition">\n    <choose>\n      <if type="bill book graphic legal_case legislation motion_picture report song" match="any">\n        <choose>\n          <if is-numeric="edition">\n            <group delimiter=" " prefix=". ">\n              <number variable="edition" form="ordinal"/>\n              <text term="edition" form="short" strip-periods="true"/>\n            </group>\n          </if>\n          <else>\n            <text variable="edition" text-case="capitalize-first" prefix=". "/>\n          </else>\n        </choose>\n      </if>\n      <else-if type="chapter entry-dictionary entry-encyclopedia paper-conference" match="any">\n        <choose>\n          <if is-numeric="edition">\n            <group delimiter=" " prefix=", ">\n              <number variable="edition" form="ordinal"/>\n              <text term="edition" form="short"/>\n            </group>\n          </if>\n          <else>\n            <text variable="edition" prefix=", "/>\n          </else>\n        </choose>\n      </else-if>\n    </choose>\n  </macro>\n  <macro name="locators">\n    <choose>\n      <if type="article-journal">\n        <choose>\n          <if variable="volume">\n            <text variable="volume" prefix=" "/>\n            <group prefix=" (" suffix=")">\n              <choose>\n                <if variable="issue">\n                  <text variable="issue"/>\n                </if>\n                <else>\n                  <date variable="issued">\n                    <date-part name="month"/>\n                  </date>\n                </else>\n              </choose>\n            </group>\n          </if>\n          <else-if variable="issue">\n            <group delimiter=" " prefix=", ">\n              <text term="issue" form="short"/>\n              <text variable="issue"/>\n              <date variable="issued" prefix="(" suffix=")">\n                <date-part name="month"/>\n              </date>\n            </group>\n          </else-if>\n          <else>\n            <date variable="issued" prefix=", ">\n              <date-part name="month"/>\n            </date>\n          </else>\n        </choose>\n      </if>\n      <else-if type="legal_case">\n        <text variable="volume" prefix=", "/>\n        <text variable="container-title" prefix=" "/>\n        <text variable="page" prefix=" "/>\n      </else-if>\n      <else-if type="bill book graphic legal_case legislation motion_picture report song" match="any">\n        <group prefix=". " delimiter=". ">\n          <group>\n            <text term="volume" form="short" text-case="capitalize-first" suffix=" "/>\n            <number variable="volume" form="numeric"/>\n          </group>\n          <group>\n            <number variable="number-of-volumes" form="numeric"/>\n            <text term="volume" form="short" prefix=" " plural="true"/>\n          </group>\n        </group>\n      </else-if>\n      <else-if type="chapter entry-dictionary entry-encyclopedia paper-conference" match="any">\n        <choose>\n          <if variable="page" match="none">\n            <group prefix=". ">\n              <text term="volume" form="short" text-case="capitalize-first" suffix=" "/>\n              <number variable="volume" form="numeric"/>\n            </group>\n          </if>\n        </choose>\n      </else-if>\n    </choose>\n  </macro>\n  <macro name="locators-chapter">\n    <choose>\n      <if type="chapter entry-dictionary entry-encyclopedia paper-conference" match="any">\n        <choose>\n          <if variable="page">\n            <group prefix=", ">\n              <text variable="volume" suffix=":"/>\n              <text variable="page"/>\n            </group>\n          </if>\n        </choose>\n      </if>\n    </choose>\n  </macro>\n  <macro name="locators-article">\n    <choose>\n      <if type="article-newspaper">\n        <group prefix=", " delimiter=", ">\n          <group delimiter=" ">\n            <text variable="edition"/>\n            <text term="edition"/>\n          </group>\n          <group>\n            <text term="section" form="short" suffix=" "/>\n            <text variable="section"/>\n          </group>\n        </group>\n      </if>\n      <else-if type="article-journal">\n        <choose>\n          <if variable="volume issue" match="any">\n            <text variable="page" prefix=": "/>\n          </if>\n          <else>\n            <text variable="page" prefix=", "/>\n          </else>\n        </choose>\n      </else-if>\n    </choose>\n  </macro>\n  <macro name="point-locators">\n    <choose>\n      <if variable="locator">\n        <choose>\n          <if locator="page" match="none">\n            <choose>\n              <if type="bill book graphic legal_case legislation motion_picture report song" match="any">\n                <choose>\n                  <if variable="volume">\n                    <group>\n                      <text term="volume" form="short" suffix=" "/>\n                      <number variable="volume" form="numeric"/>\n                      <label variable="locator" form="short" prefix=", " suffix=" "/>\n                    </group>\n                  </if>\n                  <else>\n                    <label variable="locator" form="short" suffix=" "/>\n                  </else>\n                </choose>\n              </if>\n              <else>\n                <label variable="locator" form="short" suffix=" "/>\n              </else>\n            </choose>\n          </if>\n          <else-if type="bill book graphic legal_case legislation motion_picture report song" match="any">\n            <number variable="volume" form="numeric" suffix=":"/>\n          </else-if>\n        </choose>\n        <text variable="locator"/>\n      </if>\n    </choose>\n  </macro>\n  <macro name="container-prefix">\n    <text term="in" text-case="capitalize-first"/>\n  </macro>\n  <macro name="container-title">\n    <choose>\n      <if type="chapter entry-dictionary entry-encyclopedia paper-conference" match="any">\n        <text macro="container-prefix" suffix=" "/>\n      </if>\n    </choose>\n    <choose>\n      <if type="webpage">\n        <text variable="container-title" text-case="title"/>\n      </if>\n      <else-if type="legal_case" match="none">\n        <group delimiter=" ">\n          <text variable="container-title" text-case="title" font-style="italic"/>\n          <choose>\n            <if type="post-weblog">\n              <text value="(blog)"/>\n            </if>\n          </choose>\n        </group>\n      </else-if>\n    </choose>\n  </macro>\n  <macro name="publisher">\n    <group delimiter=": ">\n      <text variable="publisher-place"/>\n      <text variable="publisher"/>\n    </group>\n  </macro>\n  <macro name="date">\n    <choose>\n      <if variable="issued">\n        <group delimiter=" ">\n          <date variable="original-date" form="text" date-parts="year" prefix="(" suffix=")"/>\n          <date variable="issued">\n            <date-part name="year"/>\n          </date>\n        </group>\n      </if>\n      <else-if variable="status">\n        <text variable="status" text-case="capitalize-first"/>\n      </else-if>\n      <else>\n        <text term="no date" form="short"/>\n      </else>\n    </choose>\n  </macro>\n  <macro name="date-in-text">\n    <choose>\n      <if variable="issued">\n        <group delimiter=" ">\n          <date variable="original-date" form="text" date-parts="year" prefix="[" suffix="]"/>\n          <date variable="issued">\n            <date-part name="year"/>\n          </date>\n        </group>\n      </if>\n      <else-if variable="status">\n        <text variable="status"/>\n      </else-if>\n      <else>\n        <text term="no date" form="short"/>\n      </else>\n    </choose>\n  </macro>\n  <macro name="day-month">\n    <date variable="issued">\n      <date-part name="month"/>\n      <date-part name="day" prefix=" "/>\n    </date>\n  </macro>\n  <macro name="collection-title">\n    <choose>\n      <if match="none" type="article-journal">\n        <choose>\n          <if match="none" is-numeric="collection-number">\n            <group delimiter=", ">\n              <text variable="collection-title" text-case="title"/>\n              <text variable="collection-number"/>\n            </group>\n          </if>\n          <else>\n            <group delimiter=" ">\n              <text variable="collection-title" text-case="title"/>\n              <text variable="collection-number"/>\n            </group>\n          </else>\n        </choose>\n      </if>\n    </choose>\n  </macro>\n  <macro name="collection-title-journal">\n    <choose>\n      <if type="article-journal">\n        <group delimiter=" ">\n          <text variable="collection-title"/>\n          <text variable="collection-number"/>\n        </group>\n      </if>\n    </choose>\n  </macro>\n  <macro name="event">\n    <group>\n      <text term="presented at" suffix=" "/>\n      <text variable="event"/>\n    </group>\n  </macro>\n  <macro name="description">\n    <choose>\n      <if type="interview">\n        <group delimiter=". ">\n          <text macro="interviewer"/>\n          <text variable="medium" text-case="capitalize-first"/>\n        </group>\n      </if>\n      <else-if type="patent">\n        <group delimiter=" " prefix=". ">\n          <text variable="authority"/>\n          <text variable="number"/>\n        </group>\n      </else-if>\n      <else>\n        <text variable="medium" text-case="capitalize-first" prefix=". "/>\n      </else>\n    </choose>\n    <choose>\n      <if variable="title" match="none"/>\n      <else-if type="thesis personal_communication speech" match="any"/>\n      <else>\n        <group delimiter=" " prefix=". ">\n          <text variable="genre" text-case="capitalize-first"/>\n          <choose>\n            <if type="report">\n              <text variable="number"/>\n            </if>\n          </choose>\n        </group>\n      </else>\n    </choose>\n  </macro>\n  <macro name="issue">\n    <choose>\n      <if type="legal_case">\n        <text variable="authority" prefix=". "/>\n      </if>\n      <else-if type="speech">\n        <group prefix=". " delimiter=", ">\n          <group delimiter=" ">\n            <text variable="genre" text-case="capitalize-first"/>\n            <text macro="event"/>\n          </group>\n          <text variable="event-place"/>\n          <text macro="day-month"/>\n        </group>\n      </else-if>\n      <else-if type="article-newspaper article-magazine personal_communication" match="any">\n        <date variable="issued" form="text" prefix=", "/>\n      </else-if>\n      <else-if type="patent">\n        <group delimiter=", " prefix=", ">\n          <group delimiter=" ">\n            \x3c!--Needs Localization--\x3e\n            <text value="filed"/>\n            <date variable="submitted" form="text"/>\n          </group>\n          <group delimiter=" ">\n            <choose>\n              <if variable="issued submitted" match="all">\n                <text term="and"/>\n              </if>\n            </choose>\n            \x3c!--Needs Localization--\x3e\n            <text value="issued"/>\n            <date variable="issued" form="text"/>\n          </group>\n        </group>\n      </else-if>\n      <else-if type="article-journal" match="any"/>\n      <else>\n        <group prefix=". " delimiter=", ">\n          <choose>\n            <if type="thesis">\n              <text variable="genre" text-case="capitalize-first"/>\n            </if>\n          </choose>\n          <text macro="publisher"/>\n        </group>\n      </else>\n    </choose>\n  </macro>\n  <citation et-al-min="4" et-al-use-first="1" disambiguate-add-year-suffix="true" disambiguate-add-names="true" disambiguate-add-givenname="true" givenname-disambiguation-rule="primary-name" collapse="year" after-collapse-delimiter="; ">\n    <layout prefix="(" suffix=")" delimiter="; ">\n      <group delimiter=", ">\n        <choose>\n          <if variable="issued accessed" match="any">\n            <group delimiter=" ">\n              <text macro="contributors-short"/>\n              <text macro="date-in-text"/>\n            </group>\n          </if>\n          \x3c!---comma before forthcoming and n.d.--\x3e\n          <else>\n            <group delimiter=", ">\n              <text macro="contributors-short"/>\n              <text macro="date-in-text"/>\n            </group>\n          </else>\n        </choose>\n        <text macro="point-locators"/>\n      </group>\n    </layout>\n  </citation>\n  <bibliography hanging-indent="true" et-al-min="11" et-al-use-first="7" subsequent-author-substitute="&#8212;&#8212;&#8212;" entry-spacing="0">\n    <sort>\n      <key macro="contributors"/>\n      <key variable="issued"/>\n      <key variable="title"/>\n    </sort>\n    <layout suffix=".">\n      <group delimiter=". ">\n        <text macro="contributors"/>\n        <text macro="date"/>\n        <text macro="title"/>\n      </group>\n      <text macro="description"/>\n      <text macro="secondary-contributors" prefix=". "/>\n      <text macro="container-title" prefix=". "/>\n      <text macro="container-contributors"/>\n      <text macro="edition"/>\n      <text macro="locators-chapter"/>\n      <text macro="collection-title-journal" prefix=", " suffix=", "/>\n      <text macro="locators"/>\n      <text macro="collection-title" prefix=". "/>\n      <text macro="issue"/>\n      <text macro="locators-article"/>\n      <text macro="access" prefix=". "/>\n    </layout>\n  </bibliography>\n</style>\n');var le=function(e){try{var t=new ie.a(e.data);return{citation:function(e){return e.replace(/^\(|\)$/g,"")}(t.format("citation",{template:"chicago-author-date"})),bibliography:t.format("bibliography",{template:"chicago-author-date"}).trim()}}catch(a){return{citation:"Error",bibliography:"Error"}}},se=function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={highlightOnlyResult:!0,isLoading:!1,options:[]},e._renderMenuItemChildren=function(e,t,a){return[e.citation,r.a.createElement("div",{className:"dropdown-item-bibliography",key:"bibliography"},e.bibliography)]},e.filterBy=function(e,t){var a=t.text;return e.id||Object(ee.defaultFilterBy)(e,Object(C.a)(Object(C.a)({},t),{},{filterBy:["citation","bibliography"]}))||Object(te.compareTwoStrings)(a,e.bibliography)>.1},e.onSearch=function(){var t=Object(m.a)(u.a.mark((function t(a){var n,r,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({isLoading:!0}),t.next=3,W.service("graphs").find({query:{searchQuery:a}});case 3:return n=t.sent,t.next=6,re(a);case 6:r=t.sent,o=r.map(ne).filter(ae).map((function(e){return Object(C.a)({data:e},le({data:e}))})).filter((function(e,t){var a,r=Object(Z.a)(n);try{for(r.s();!(a=r.n()).done;){var o=a.value;return Object(te.compareTwoStrings)(e.bibliography,o.bibliography)<.67}}catch(i){r.e(i)}finally{r.f()}return!0})).sort((function(e,t){return Object(te.compareTwoStrings)(e.bibliography,a)<Object(te.compareTwoStrings)(t.bibliography,a)?1:-1})),e.setState({isLoading:!1,options:[].concat(Object(Q.a)(n),Object(Q.a)(o))});case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.onChange=function(t){var a=e.props.setTargetWork;t.length>0&&a(t[0])},e}return Object(g.a)(a,[{key:"render",value:function(){var e=this.state,t=e.highlightOnlyResult,a=e.isLoading,n=e.options;return r.a.createElement(X.a,{isLoading:a,delay:670,labelKey:"citation",filterBy:this.filterBy,renderMenuItemChildren:this._renderMenuItemChildren,highlightOnlyResult:t,options:n,onChange:this.onChange,onSearch:this.onSearch,maxHeight:"33vh",placeholder:"Type to search for works via CrossRef\u2026",selectHintOnEnter:!0,clearButton:!0})}}]),a}(n.Component),ce=function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(g.a)(a,[{key:"render",value:function(){var e=this.props,t=e.setTargetWork,a=e.stagedWorkType,n=e.targetWork,o=null===n?null:r.a.createElement(z.a,null,r.a.createElement(z.a.Body,null,r.a.createElement(z.a.Text,null,r.a.createElement($,null,n.bibliography))));return r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a.Label,{htmlFor:"metadata-search-".concat(a)},"Bibliographic search terms (title, author, year)"),r.a.createElement(j.a,{className:"mb-3"},r.a.createElement(se,{identifier:"metadata-search-".concat(a),setTargetWork:t})),o)}}]),a}(n.Component),ue=function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).setTargetWork=function(e){n.setState({targetWork:e})},n.stageWork=function(){var e=n.props,t=e.setStagedRelation,a=e.stagedRelation,r=e.stagedWorkType,o=n.state.targetWork;t(Object(C.a)(Object(C.a)({},a),{},Object(R.a)({},r,o)))},n.unstageWork=function(){var e=n.props,t=e.setStagedRelation,a=e.stagedRelation,r=e.stagedWorkType;n.setTargetWork(a[r]),t(Object(C.a)(Object(C.a)({},a),{},Object(R.a)({},r,null)))},n.state={targetWork:null},n}return Object(g.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.stagedRelation,n=t.stagedWorkType,o=this.state.targetWork,i=a[n],l="workFrom"===n?"Subject Work":"Object Work";return i?r.a.createElement(V.a,{key:n,overlay:r.a.createElement(Y.a,null,"Click to edit selected work")},r.a.createElement(z.a,{className:"mt-3 select-work-card-staged",onClick:this.unstageWork,onKeyPress:function(t){"Enter"===t.key&&e.unstageWork()},tabIndex:0},r.a.createElement(z.a.Header,null,l),r.a.createElement(z.a.Body,null,r.a.createElement(z.a.Text,null,r.a.createElement($,null,i.bibliography))))):r.a.createElement(z.a,{className:"mt-3"},r.a.createElement(z.a.Header,null,l),r.a.createElement(z.a.Body,null,r.a.createElement(J.a.Container,{variant:"success",defaultActiveKey:"add-search-pane"},r.a.createElement(v.a,null,r.a.createElement(f.a,{sm:12},r.a.createElement(J.a.Content,null,r.a.createElement(J.a.Pane,{eventKey:"add-search-pane"},r.a.createElement(ce,{setTargetWork:this.setTargetWork,stagedWorkType:n,targetWork:o}))))))),r.a.createElement(z.a.Footer,null,r.a.createElement(k.a,{variant:"primary",className:"float-right",onClick:this.stageWork},"Select Work")))}}]),a}(n.Component),me=a(284),de=a.n(me),ge=function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).swapStagedWorks=function(){var t=e.props,a=t.setStagedRelation,n=t.stagedRelation,r=n.workFrom,o={workFrom:n.workTo,workTo:r};a(Object(C.a)(Object(C.a)({},n),o))},e}return Object(g.a)(a,[{key:"render",value:function(){var e=this.props,t=e.currentUser,a=e.relataConfig,n=e.stagedAnnotation,o=e.stagedRelation,i=o.type,l=o.workFrom,s=o.workTo,c=null===l?"____________":l.citation,u=null===s?"____________":s.citation,m=i||"____________",d=a.types[i],g=d?d.preposition:"in relation to",p="".concat(de()(m)," ").concat(g),h=t.displayName?r.a.createElement(r.a.Fragment,null,r.a.createElement("b",{className:"relation-lead"},t.displayName)," "):null,f=n?r.a.createElement(z.a.Footer,null,r.a.createElement(z.a.Text,{className:"text-dark"},h,n)):null;return r.a.createElement(z.a,{border:"dark"},r.a.createElement(z.a.Body,null,r.a.createElement(k.a,{className:"float-right",variant:"primary",size:"sm",onClick:this.swapStagedWorks},"Reverse"),c," represents ",p," ",u,"."),f)}}]),a}(n.Component),pe=function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).isReadyToSubmit=function(){var e=n.props.stagedRelation;return null!==e.type&&null!==e.workFrom&&null!==e.workTo},n.deleteRelation=Object(m.a)(u.a.mark((function e(){var t,a,r,o,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.props,a=t.selectWork,r=t.stagedRelation,o=t.toggleEditRelationModal,r.id){e.next=3;break}return e.abrupt("return");case 3:return i=W.service("relations"),e.prev=4,e.next=7,i.remove(r.id);case 7:o(),a(),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(4),e.abrupt("return");case 14:case"end":return e.stop()}}),e,null,[[4,11]])}))),n.submitRelation=Object(m.a)(u.a.mark((function e(){var t,a,r,o,i,l,s,c,m,d,g,p,h,f,b,v;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.props,a=t.currentUser,r=t.currentWork,o=t.selectWork,i=t.stagedAnnotation,l=t.stagedRelation,s=t.toggleEditRelationModal,c=l.type,m=l.workFrom,d=l.workTo,n.setState({isSubmitting:!0}),g=W.service("works"),p=W.service("relations"),e.prev=5,!m.id){e.next=10;break}e.t0=m,e.next=13;break;case 10:return e.next=12,g.create(m);case 12:e.t0=e.sent;case 13:if(h=e.t0,!d.id){e.next=18;break}e.t1=d,e.next=21;break;case 18:return e.next=20,g.create(d);case 20:e.t1=e.sent;case 21:f=e.t1,e.next=29;break;case 24:return e.prev=24,e.t2=e.catch(5),console.log("There was an error:",e.t2),n.setState({isSubmitting:!1}),e.abrupt("return");case 29:if(b={type:c,workFromId:h.id,workToId:f.id,annotation:i,annotationAuthor:null,userId:a.id},v=null!==l.id,e.prev=31,!v){e.next=37;break}return e.next=35,p.update(l.id,b);case 35:e.next=39;break;case 37:return e.next=39,p.create(b);case 39:e.next=46;break;case 41:return e.prev=41,e.t3=e.catch(31),console.log("There was an error:",e.t3),n.setState({isSubmitting:!1}),e.abrupt("return");case 46:r.id===h.id||r.id===f.id?o():o(f.id),s(),n.setState({isSubmitting:!1});case 49:case"end":return e.stop()}}),e,null,[[5,24],[31,41]])}))),n.state={isSubmitting:!1},n}return Object(g.a)(a,[{key:"componentDidMount",value:function(){this.setState({isSubmitting:!1})}},{key:"render",value:function(){var e=this.props,t=e.currentUser,a=e.relataConfig,n=e.setStagedAnnotation,o=e.setStagedRelation,i=e.showEditRelationModal,l=e.stagedAnnotation,s=e.stagedRelation,c=e.toggleEditRelationModal,u=this.state.isSubmitting,m=s.id?"Edit Relation":"Add Relation",d=s.id?r.a.createElement(B.a,{variant:"warning",className:"align-middle"},r.a.createElement(k.a,{className:"float-right align-middle ml-1 mb-1",variant:"outline-danger",onClick:this.deleteRelation},"Delete"),r.a.createElement("b",null,"Please note:")," You are editing an existing relation. To permanently delete this relation from Relata, click the Delete button at right."):null,g=!this.isReadyToSubmit();return r.a.createElement(O.a,{show:i,onHide:c,size:"lg"},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,m)),r.a.createElement(O.a.Body,null,d,r.a.createElement(ge,{currentUser:t,relataConfig:a,setStagedAnnotation:n,setStagedRelation:o,stagedAnnotation:l,stagedRelation:s}),r.a.createElement(ue,{setStagedRelation:o,stagedRelation:s,stagedWorkType:"workFrom"}),r.a.createElement(G,{relataConfig:a,setStagedAnnotation:n,setStagedRelation:o,stagedAnnotation:l,stagedRelation:s}),r.a.createElement(ue,{setStagedRelation:o,stagedRelation:s,stagedWorkType:"workTo"})),r.a.createElement(O.a.Footer,null,r.a.createElement(B.a,{variant:"light"},"All relation data are publicly and freely accessible. By submitting this relation, you agree to waive all copyright to it under the ",r.a.createElement(B.a.Link,{href:"https://creativecommons.org/publicdomain/zero/1.0/"},"Creative Commons Zero 1.0 Universal Public Domain Dedication"),"."),r.a.createElement(k.a,{variant:"outline-secondary",onClick:c},"Cancel"),r.a.createElement(k.a,{disabled:g||u,style:g||u?{cursor:"not-allowed"}:{},variant:"primary",onClick:this.submitRelation},u?"Submitting\u2026":"Submit")))}}]),a}(n.Component),he=a(119),fe=function(e){var t=e.fetchResults,a=e.message,n=e.noResultsMessage,o=e.transformResult,i=e.results;if(!i)return n;var l=i.data,s=i.limit,c=i.skip,u=i.total;if(!l)return null;if(l.length<1)return n;var m=0===c,d=c+s>=u,g=c-s<1?0:c-s,p=Math.floor(u/s)*s,h=c+s>u?p:c+s,b=c+1,y=b+l.length-1,x=l.map(o);return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,a),r.a.createElement(z.a,{className:"mb-3"},r.a.createElement(N.a,{className:"paginated-results-list",variant:"flush",style:{overflow:"scroll",maxHeight:"24rem"}},x)),r.a.createElement(f.a,null,r.a.createElement(v.a,{className:"justify-content-center"},r.a.createElement(he.a,null,r.a.createElement(he.a.First,{disabled:m,onClick:function(){return t(0)},style:m?{cursor:"not-allowed"}:null}),r.a.createElement(he.a.Prev,{disabled:m,onClick:function(){return t(g)},style:m?{cursor:"not-allowed"}:null}),r.a.createElement("div",{className:"text-center pt-2 pb-2 pl-3 pr-3"},"Showing ",b,"-",y," of ",u),r.a.createElement(he.a.Next,{disabled:d,onClick:function(){return t(h)},style:d?{cursor:"not-allowed"}:null}),r.a.createElement(he.a.Last,{disabled:d,onClick:function(){return t(p)},style:d?{cursor:"not-allowed"}:null})))))},be=function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).toggleEditExistingRelationModal=function(e){var t=n.props,a=t.setStagedAnnotation,r=t.setStagedRelation,o=t.stagedRelation,i=t.toggleEditRelationModal,l=t.toggleContributionsModal,s=e.workFrom,c=e.workTo,u=Object(C.a)(Object(C.a)({},s),le(s)),m=Object(C.a)(Object(C.a)({},c),le(c));a(e.annotation),r(Object(C.a)(Object(C.a)({},o),{},{id:e.id,type:e.type,workFrom:u,workTo:m})),l(),i()},n.makeContributionRow=function(e){var t=n.props,a=t.getRelationColor,o=t.selectWork,i=Object(C.a)(Object(C.a)({},e.workFrom),le(e.workFrom)),l=Object(C.a)(Object(C.a)({},e.workTo),le(e.workTo)),s=a(e.type),c=Object(L.a)(e.updatedAt),u=(e.updatedAt===e.createdAt?"Created ":"Updated ")+Object(F.a)(c,{addSuffix:!0}),m=Object(_.a)(c,"PPPPp");return r.a.createElement(N.a.Item,{as:"a",key:e.id,className:"paginated-results-item",style:{borderLeft:"0.25rem solid ".concat(s)},onClick:function(){o(e.workTo.id),n.props.toggleContributionsModal()},action:!0},r.a.createElement("span",{className:"align-middle"},r.a.createElement("span",{className:"mr-2"},r.a.createElement("span",{className:"relation-lead"},e.type)," ",i.citation," \u2192 ",l.citation)," ",r.a.createElement("span",{className:"text-muted",title:m},u)),r.a.createElement(k.a,{className:"float-right",variant:"success",size:"sm",onClick:function(t){t.stopPropagation(),n.toggleEditExistingRelationModal(e)}},"Edit"))},n.state={},n}return Object(g.a)(a,[{key:"render",value:function(){var e=this.props,t=e.currentUser,a=e.getUserRelations,n=e.relataConfig,o=e.selectWork,i=e.setStagedAnnotation,l=e.setStagedRelation,s=e.showContributionsModal,c=e.showEditRelationModal,u=e.stagedAnnotation,m=e.stagedRelation,d=e.toggleEditRelationModal,g=e.toggleContributionsModal,p=e.userRelations;return r.a.createElement(O.a,{show:s,onHide:g,size:"lg"},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,"Contributions")),r.a.createElement(O.a.Body,null,r.a.createElement(fe,{message:"You have contributed the following relations to Relata. Click on a relation to view it:",noResultsMessage:"You have not yet contributed any relations to Relata.",fetchResults:a,transformResult:this.makeContributionRow,results:p}),r.a.createElement(pe,{currentUser:t,relataConfig:n,selectWork:o,setStagedAnnotation:i,setStagedRelation:l,showEditRelationModal:c,stagedAnnotation:u,stagedRelation:m,toggleEditRelationModal:d})),r.a.createElement(O.a.Footer,null,r.a.createElement(k.a,{variant:"outline-secondary",onClick:g},"Close")))}}]),a}(n.Component),ve=function(e){var t=e.getRelationColor,a=e.relataConfig,n=e.showGlossaryModal,o=e.toggleGlossaryModal,i=(a.types?Object.keys(a.types).filter((function(e){return"*"!==e})).sort():[]).map((function(e){var n=a.types[e].definition,o=t(e);return r.a.createElement(N.a.Item,{key:e,style:{borderLeft:"0.25rem solid ".concat(o)}},r.a.createElement("b",{className:"relation-lead"},e)," ",n)}));return r.a.createElement(O.a,{show:n,onHide:o,size:"lg"},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,"Glossary")),r.a.createElement(O.a.Body,null,r.a.createElement(z.a,null,r.a.createElement(N.a,{variant:"flush"},i))),r.a.createElement(O.a.Footer,null,r.a.createElement(k.a,{variant:"outline-secondary",onClick:o},"Close")))},ye=function(e){var t=e.relataConfig,a=e.showLoginModal,n=e.toggleLoginModal,o=t.oauthProviders?t.oauthProviders.map((function(e){var t=e.id,a=e.name,n=e.iconClass,o=r.a.createElement("i",{className:n||"fab fa-".concat(t)});return r.a.createElement(k.a,{key:t,variant:"outline-primary",href:"/oauth/".concat(t),block:!0},o," Connect via ",a)})):null;return r.a.createElement(O.a,{show:a,onHide:n},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,"Sign In")),r.a.createElement(O.a.Body,null,r.a.createElement("p",null,"Use one of the following services to sign into Relata:"),o),r.a.createElement(O.a.Footer,null,r.a.createElement(k.a,{variant:"outline-secondary",onClick:n},"Close")))},xe=a(212),ke=function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={highlightOnlyResult:!0,isLoading:!1,options:[]},e._renderMenuItemChildren=function(e,t,a){return[e.citation,r.a.createElement("div",{className:"dropdown-item-bibliography",key:"bibliography"},e.bibliography)]},e.filterBy=function(e,t){var a=t.text;return Boolean(e.id||Object(xe.defaultFilterBy)(e,Object(C.a)(Object(C.a)({},t),{},{filterBy:["citation","bibliography"]}))||Object(te.compareTwoStrings)(a,e.bibliography)>.1)},e.onSearch=function(t){e.setState({isLoading:!0}),W.service("graphs").find({query:{searchQuery:t}}).then((function(t){e.setState({isLoading:!1,options:t})}))},e.onChange=function(t){var a=e.props.selectWork;t.length>0&&(a(t[0].id),e.typeahead.clear())},e}return Object(g.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.highlightOnlyResult,n=t.isLoading,o=t.options;return r.a.createElement(X.a,{id:"nav-search",ref:function(t){return e.typeahead=t},className:"col-md-4 col-sm-12 p-0",isLoading:n,delay:670,labelKey:"citation",filterBy:this.filterBy,renderMenuItemChildren:this._renderMenuItemChildren,highlightOnlyResult:a,options:o,onChange:this.onChange,onSearch:this.onSearch,maxHeight:"67vh",placeholder:"Type to search for works in Relata\u2026",selectHintOnEnter:!0,clearButton:!0})}}]),a}(n.Component),Ee=function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).deleteUser=function(e){var t=n.props.getUsers;W.service("users").remove(e).then((function(e){return t()}))},n.makeUserRow=function(e){var t=n.props.currentUser,a=1===e.isAdmin?"administrator":null,o=[e.displayName,e.email,a].filter((function(e){return e})).join(" | "),i=e.id===t.id?r.a.createElement(r.a.Fragment,null," ",r.a.createElement("i",null,"(current user)")):null,l=e.id===t.id?null:r.a.createElement(k.a,{className:"float-right",variant:"outline-danger",size:"sm",onClick:function(){return n.deleteUser(e.id)}},"Delete");return r.a.createElement(N.a.Item,{key:e.id},r.a.createElement("span",{className:"align-middle"},r.a.createElement("span",{className:"relation-lead"},"User ",e.id)," ",o,i,l))},n.state={},n}return Object(g.a)(a,[{key:"render",value:function(){var e=this.props,t=e.getUsers,a=e.showUsersModal,n=e.toggleUsersModal,o=e.users;return r.a.createElement(O.a,{show:a,onHide:n,size:"lg"},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,"Users")),r.a.createElement(O.a.Body,null,r.a.createElement(B.a,{variant:"warning"},r.a.createElement("b",null,"Please note:")," Deleting a user will also permanently delete all relations created by that user. Be careful when deleting users!"),r.a.createElement(fe,{message:"As an administrator, you can use this interface to review and permanently delete Relata users. The database contains the following users:",noResultsMessage:"Could not find any users in the Relata database.",fetchResults:t,transformResult:this.makeUserRow,results:o})),r.a.createElement(O.a.Footer,null,r.a.createElement(k.a,{variant:"outline-secondary",onClick:n},"Close")))}}]),a}(n.Component),we=function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).getUserRelations=function(e){var t=n.props.currentUser;W.service("relations").find({query:{$limit:20,$skip:e,$sort:{updatedAt:-1},userId:t.id,expand:!0}}).then((function(e){n.setState({userRelations:e})}))},n.getUsers=function(e){1===n.props.currentUser.isAdmin&&W.service("users").find({query:{$limit:20,$skip:e,$sort:{id:1}}}).then((function(e){n.setState({users:e})}))},n.setStagedUserId=function(e){console.log("Setting staged userId",e),n.setState({stagedUserId:e}),console.log("StagedUserId",n.state.stagedUserId)},n.setStagedUserPatch=function(e){n.setState({stagedUserPatch:e})},n.toggleAccountModal=function(){var e=n.props.currentUser,t=n.state.showAccountModal;t||n.setStagedUserPatch({displayName:e.displayName,email:e.email}),n.setState({showAccountModal:!t})},n.toggleContributionsModal=function(){var e=n.state.showContributionsModal;e||n.getUserRelations(0),n.setState({showContributionsModal:!e})},n.toggleGlossaryModal=function(){var e=n.state.showGlossaryModal;n.setState({showGlossaryModal:!e})},n.toggleLoginModal=function(){var e=n.state.showLoginModal;n.setState({showLoginModal:!e})},n.toggleUsersModal=function(){var e=n.state.showUsersModal;e||n.getUsers(0),n.setState({showUsersModal:!e})},n.state={showContributionsModal:!1,showGlossaryModal:!1,showAccountModal:!1,showLoginModal:!1,showUsersModal:!1,stagedUserId:null,stagedUserPatch:{},userRelations:{},users:{}},n}return Object(g.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.currentUser,n=t.getRelationColor,o=t.login,i=t.logout,l=t.relataConfig,s=t.selectWork,c=t.setStagedAnnotation,u=t.setStagedRelation,m=t.showEditRelationModal,d=t.stagedAnnotation,g=t.stagedRelation,p=t.toggleEditRelationModal,h=this.state,f=h.showContributionsModal,b=h.showGlossaryModal,v=h.showAccountModal,y=h.showLoginModal,x=h.showUsersModal,R=h.stagedUserPatch,C=h.userRelations,S=h.users,j=l?l.aboutUrl:"https://culanth.org/engagements/relata",O=a?r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a.Link,{onClick:function(){e.setStagedUserId(a.id),e.setStagedUserPatch({displayName:a.displayName,email:a.email}),e.toggleAccountModal()}},"Account"),r.a.createElement(E.a.Link,{onClick:this.toggleContributionsModal},"Contributions"),1===a.isAdmin?r.a.createElement(E.a.Link,{onClick:this.toggleUsersModal},"Users"):null,r.a.createElement(E.a.Link,{onClick:i},"Sign Out")):r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a.Link,{onClick:this.toggleLoginModal},"Sign In")),M=r.a.createElement(ve,{getRelationColor:n,relataConfig:l,showGlossaryModal:b,toggleGlossaryModal:this.toggleGlossaryModal}),U=a?r.a.createElement(T,{currentUser:a,login:o,relataConfig:l,selectWork:s,setStagedUserPatch:this.setStagedUserPatch,showAccountModal:v,stagedUserPatch:R,targetUser:a,toggleAccountModal:this.toggleAccountModal}):null,A=a?r.a.createElement(be,{currentUser:a,getRelationColor:n,getUserRelations:this.getUserRelations,relataConfig:l,selectWork:s,setStagedAnnotation:c,setStagedRelation:u,showContributionsModal:f,showEditRelationModal:m,stagedAnnotation:d,stagedRelation:g,toggleContributionsModal:this.toggleContributionsModal,toggleEditRelationModal:p,userRelations:C}):null,W=a?null:r.a.createElement(ye,{relataConfig:l,showLoginModal:y,toggleLoginModal:this.toggleLoginModal}),N=a&&1===a.isAdmin?r.a.createElement(Ee,{currentUser:a,getUsers:this.getUsers,showUsersModal:x,toggleUsersModal:this.toggleUsersModal,users:S}):null;return r.a.createElement(w.a,{id:"navbar",bg:"light",variant:"light",expand:"lg",fluid:"true"},r.a.createElement(k.a,{className:"sr-only sr-only-focusable p-2 pl-3 pr-3",variant:"light",href:"#content",style:{position:"absolute"}},"Skip to main content"),r.a.createElement(w.a.Brand,{href:"/"},"Relata"),r.a.createElement(w.a.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(w.a.Collapse,null,r.a.createElement(E.a,null,r.a.createElement(E.a.Link,{href:j,target:"_blank",rel:"noopener noreferrer"},"About"),r.a.createElement(E.a.Link,{target:"_blank",rel:"noopener noreferrer",onClick:this.toggleGlossaryModal},"Glossary"),O)),r.a.createElement(ke,{selectWork:s}),M,U,A,W,A,N)}}]),a}(n.Component),Re=function(e){var t=e.currentWork;return r.a.createElement(z.a,{border:"dark",className:"mb-3"},r.a.createElement(z.a.Body,null,r.a.createElement(z.a.Text,null,r.a.createElement($,null,t.bibliography))))},Ce=function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).toggleEditExistingRelationModal=function(t){var a=e.props,n=a.currentWork,r=a.setStagedAnnotation,o=a.setStagedRelation,i=a.stagedRelation,l=a.toggleEditRelationModal;r(t.annotation),o(Object(C.a)(Object(C.a)({},i),{},{id:t.id,type:t.type,workFrom:t.workFrom,workTo:n})),l()},e}return Object(g.a)(a,[{key:"render",value:function(){var e,t=this,a=this.props,n=a.currentUser,o=a.relataConfig,i=a.relation,l=a.selectWork;if(o&&o.types&&o.types[i.type]&&o.types[i.type].definition){var s=r.a.createElement(Y.a,null,o.types[i.type].definition);e=r.a.createElement(V.a,{placement:"top",overlay:s},r.a.createElement("b",{className:"relation-lead"},i.type))}else e=r.a.createElement("b",{className:"relation-lead"},i.type);var c=i.annotationAuthor||i.user.displayName||"Anonymous User",u=i.annotation?r.a.createElement(z.a.Footer,null,r.a.createElement(z.a.Text,{className:"text-dark"},r.a.createElement("b",{className:"relation-lead"},c)," ",i.annotation)):null,m=n&&i.user.id===n.id?r.a.createElement(k.a,{className:"float-right ml-2 mb-2",variant:"success",onClick:function(e){e.stopPropagation(),t.toggleEditExistingRelationModal(i)}},"Edit"):null;return r.a.createElement(z.a,{className:"relation-card mt-3",onClick:function(){return l(i.workFrom.id)},onKeyPress:function(e){"Enter"===e.key&&l(i.workFrom.id)},style:{borderLeftColor:i.color},tabIndex:0},r.a.createElement(z.a.Body,null,r.a.createElement(z.a.Text,null,m,e," ",r.a.createElement($,null,i.workFrom.bibliography))),u)}}]),a}(n.Component),Se=function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).toggleAddRelationModal=function(){var e=n.props,t=e.currentWork,a=e.showEditRelationModal,r=e.setStagedRelation,o=e.stagedRelation,i=e.toggleEditRelationModal;a||(r(Object(C.a)(Object(C.a)({},o),{},{workTo:t})),i())},n.state={},n}return Object(g.a)(a,[{key:"render",value:function(){var e=this.props,t=e.currentUser,a=e.currentWork,n=e.relataConfig,o=e.selectWork,i=e.setStagedAnnotation,l=e.setStagedRelation,s=e.stagedAnnotation,c=e.stagedRelation,u=e.showEditRelationModal,m=e.toggleEditRelationModal,d=a.relationsTo?a.relationsTo.map((function(e,d){return r.a.createElement(Ce,{key:e.id,currentUser:t,currentWork:a,relataConfig:n,relation:e,selectWork:o,setStagedAnnotation:i,setStagedRelation:l,showEditRelationModal:u,stagedAnnotation:s,stagedRelation:c,toggleEditRelationModal:m})})):null,g=t?r.a.createElement(k.a,{variant:"primary",onClick:this.toggleAddRelationModal},"Add Relation"):null;return r.a.createElement("div",null,r.a.createElement(Re,{currentWork:a}),r.a.createElement("div",{className:"mt-3 text-right"},g,r.a.createElement(pe,{currentUser:t,currentWork:a,relataConfig:n,selectWork:o,setStagedAnnotation:i,setStagedRelation:l,showEditRelationModal:u,stagedAnnotation:s,stagedRelation:c,toggleEditRelationModal:m})),d)}}]),a}(n.Component),je=function(e){return 404===e.code?r.a.createElement(B.a,null,r.a.createElement(B.a.Heading,null,"Not found")):r.a.createElement(B.a,null,r.a.createElement(B.a.Heading,null,"Error"))},Oe=(a(428),a(429),a(430),a(431),function(e){Object(p.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).setInitialState=function(e){W.service("graphs").get(e.toString().replace("/",",")).then((function(e){null==e?n.setState({currentWorkNotFound:!0}):n.setState({currentWork:e,currentWorkNotFound:!1,stagedRelation:{id:null,type:null,workFrom:null,workTo:null,annotation:null},showEditRelationModal:!1})}))},n.login=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];console.log("Logging in or re-authenticating\u2026"),W.reAuthenticate(e).then((function(e){var t=e.user;console.log("Authenticated"),n.setState({currentUser:t})})).catch((function(e){console.log("Failed to authenticate:",e)}))},n.logout=Object(m.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Logging out\u2026"),e.next=3,W.logout();case 3:n.setState({currentUser:null}),console.log("Logged out!");case 5:case"end":return e.stop()}}),e)}))),n.getRelataConfig=function(e){W.service("config").find().then((function(t){n.setState({relataConfig:t},e)}))},n.selectWork=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.state.currentWork.id,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null!=e&&W.service("graphs").get(e.toString().replace("/",",")).then((function(a){null==a&&e==n.state.currentWork.id?n.setState({currentWorkNotFound:!0}):n.setState({currentWork:a,currentWorkNotFound:!1},(function(){var e;e=a.doi?"doi:"+a.doi:a.id,n.props.match.params.selector=e,t&&n.props.history.push("/work/"+e+"/")}))}))},n.getRelationColor=function(e){var t=n.state.relataConfig;try{return(t.types[e]||t.types["*"]).color}catch(a){return"#808080"}},n.setStagedAnnotation=function(e){n.setState({stagedAnnotation:e})},n.setStagedRelation=function(e){n.setState({stagedRelation:e})},n.toggleEditRelationModal=function(){var e=n.state.showEditRelationModal;e&&n.setState({stagedAnnotation:null,stagedRelation:{id:null,type:null,workFrom:null,workTo:null,annotation:null}}),n.setState({showEditRelationModal:!e})},n.state={currentWork:{id:null,relationsFrom:[],relationsTo:[]},currentWorkNotFound:!1,currentUser:null,relataConfig:{},stagedAnnotation:null,stagedRelation:{id:null,type:null,workFrom:null,workTo:null},showEditRelationModal:!1},n.props.history.listen((function(e,t){var a=n.props.match.params.selector;null!==a&&a!==n.state.currentWork.id&&n.selectWork(a,!1)})),n}return Object(g.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.getRelataConfig((function(){var t=e.props.match.params.selector;if(void 0===t){var a=e.state.relataConfig.landingWorks||["1"];t=a[Math.floor(Math.random()*a.length)]}e.setInitialState(t)})),this.login()}},{key:"render",value:function(){var e=this.state,t=e.currentUser,a=e.currentWork,n=e.currentWorkNotFound,o=e.relataConfig,i=e.showEditRelationModal,l=e.stagedAnnotation,s=e.stagedRelation;return r.a.createElement("div",{className:"App"},r.a.createElement(we,{currentUser:t,getRelationColor:this.getRelationColor,login:this.login,logout:this.logout,relataConfig:o,selectWork:this.selectWork,setStagedAnnotation:this.setStagedAnnotation,setStagedRelation:this.setStagedRelation,showEditRelationModal:i,stagedAnnotation:l,stagedRelation:s,toggleEditRelationModal:this.toggleEditRelationModal}),r.a.createElement("a",{id:"content",style:{position:"absolute",top:0}}),r.a.createElement(b.a,{fluid:!0,className:"mt-3"},r.a.createElement(v.a,null,r.a.createElement(f.a,{sm:12,md:4,className:"mb-3"},n?r.a.createElement(je,{code:404}):r.a.createElement(Se,{currentUser:t,currentWork:a,relataConfig:o,selectWork:this.selectWork,setStagedAnnotation:this.setStagedAnnotation,setStagedRelation:this.setStagedRelation,showEditRelationModal:i,stagedAnnotation:l,stagedRelation:s,toggleEditRelationModal:this.toggleEditRelationModal})),r.a.createElement(f.a,{sm:12,md:8},r.a.createElement(x,{currentWork:a,selectWork:this.selectWork})))))}}]),a}(n.Component)),Me=Object(s.f)(Oe);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(l.a,null,r.a.createElement(s.c,null,r.a.createElement(s.a,{exact:!0,path:"/",component:Me}),r.a.createElement(s.a,{exact:!0,path:"/work/:selector+/",component:Me}))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[298,1,2]]]);
//# sourceMappingURL=main.ea36f67a.chunk.js.map